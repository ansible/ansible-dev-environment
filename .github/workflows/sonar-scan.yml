name: SonarCloud Analysis
on:
  workflow_run:
    workflows:
      - tox
    types:
      - completed

permissions:
  contents: read
  pull-requests: read

jobs:
  sonar-analysis:
    name: SonarCloud Analysis
    runs-on: ubuntu-latest
    if: |
      github.event.workflow_run.conclusion == 'success' &&
      (github.event.workflow_run.event == 'pull_request' ||
       (github.event.workflow_run.event == 'push' && github.event.workflow_run.head_branch == 'main'))
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          show-progress: false
          repository: ${{ github.event.workflow_run.head_repository.full_name }}
          ref: ${{ github.event.workflow_run.head_sha }}
